{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block css %}
    <link rel="stylesheet" href="{% static 'pages/css/article.css' %}">
{% endblock %}

{% block content %}
    <div style="padding: 20px"></div>

    {% if request.user.is_staff %}
        <p class="topic-id" style="display: none;">{{ topic.id }}</p>
        <div class="container mt-5">
            <!-- Image change -->

            <div class="main-image"
                 style="background-image: url({{ topic.main_image.url }}); background-repeat: no-repeat; height: 420px;
                         width: 100%;
                         background-size: cover;
                         background-position: center"></div>
            <form class="form-image" style="display: none; position:relative" action="{% url 'pages:image-change' %}"
                  method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="d-flex align-items-center w-100">
                    <span class="border" style="z-index: 10;">{{ form.main_image }}</span>
                </div>
                <input type="hidden" name="topic_id" value="{{ topic.id }}">
                <button class="image-button btn btn-secondary mt-5" type="submit">Save image</button>
            </form>

            <!-- Image change end -->


            <div class="row mt-5">
                <div class="col-lg-9 img-fluid">
                    <h6 class="main-color main-material-name">{{ topic.material_name|upper }}</h6>

                    <form class="material-name-form" style="display: none;" method="POST"
                          action="{% url 'pages:material-change' %}">
                        {% csrf_token %}
                        <p>{{ form.material_name }}</p>
                        <input type="hidden" name="topic_id" value="{{ topic.id }}">
                        <button type="submit" class=" material-name-btn btn btn-secondary mt-2">Save</button>
                    </form>


                    <div class="main-title font-weight-bold h3">{{ topic.title }}</div>
                    <form class="form-title" style="display: none;" action="{% url 'pages:title-change' %}"
                          method="POST">
                        {% csrf_token %}
                        <p>{{ form.title }}</p>
                        <input type="hidden" name="topic_id" value="{{ topic.id }}">
                        <button type="submit" class="title-btn btn btn-secondary">Save</button>
                    </form>


                    <sub class="text-secondary">{{ topic.created_at|date:'d M' }}</sub>


                    <div class="main-description mt-3 mb-5 img-fluid"
                         style="font-size: 22px;">{{ topic.description|safe }}</div>
                    <form class="description-form" style="display: none;" action="{% url 'pages:description-change' %}"
                          method="POST">
                        {% csrf_token %}
                        <p>{{ form.description }}</p>
                        <input type="hidden" name="topic_id" value="{{ topic.id }}">
                        <button type="submit" class="description-button btn btn-secondary">Save</button>
                    </form>


                    <div class="others">{{ topic.others|safe }}</div>
                    <form class="others-form" style="display: none;" action="{% url 'pages:others-change' %}"
                          method="POST">
                        {% csrf_token %}
                        <p>{{ form.others }}</p>
                        <input type="hidden" name="topic_id" value="{{ topic.id }}">
                        <button type="submit" class="others-button btn btn-secondary">Save</button>
                    </form>


                </div>
            </div>

            {% if get_by_theme %}
                <div class="font-weight-bold h4 mt-5">{% trans 'Читайте также' %}:</div>
                <div class="row mb-5">
                    {% for topic in get_by_theme %}
                        <div class="col-lg-4 my-2">
                            <div class="border h-100 rounded-bottom geometria">
                                <a href="{{ topic.get_absolute_url }}"
                                   class="text-dark text-decoration-none h-100 w-100">
                                    <img class="img-fluid rounded-top" src="{{ topic.main_image.url }}" alt=""
                                         width="100%"
                                         height="100%">
                                    <div class="mt-4 mb-5 px-4 h-100">
                                        <div class="main-color  mb-2"
                                             style="font-size: smaller">{{ topic.material_name }}</div>
                                        <div class=""
                                             style="font-size: 25px; line-height: 31px;">{{ topic.title }}</div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                </div>

            {% endif %}
        </div>
    {% else %}

        <div class="container mt-5">

            <div style="background-image: url({{ topic.main_image.url }}); background-repeat: no-repeat; height: 420px;
                    width: 100%;
                    background-size: cover;
                    background-position: center"></div>

            <div class="row mt-5">
                <div class="col-lg-9 img-fluid">
                    <h6 class="main-color">{{ topic.material_name|upper }}</h6>
                    <div class="font-weight-bold h3" style="">{{ topic.title }}</div>
                    <sub class="text-secondary">{{ topic.created_at|date:'d M' }}</sub>
                    <div class="mt-3 mb-5 img-fluid" style="font-size: 22px;">{{ topic.description|safe }}</div>

                    {{ topic.others|safe }}

                </div>
            </div>

            {% if get_by_theme %}
                <div class="font-weight-bold h4 mt-5">{% trans 'Читайте также' %}:</div>
                <div class="row mb-5">
                    {% for topic in get_by_theme %}
                        <div class="col-lg-4 my-2">
                            <div class="border h-100 rounded-bottom geometria">
                                <a href="{{ topic.get_absolute_url }}"
                                   class="text-dark text-decoration-none h-100 w-100">
                                    <img class="img-fluid rounded-top" src="{{ topic.main_image.url }}" alt=""
                                         width="100%"
                                         height="100%">
                                    <div class="mt-4 mb-5 px-4 h-100">
                                        <div class="main-color  mb-2"
                                             style="font-size: smaller">{{ topic.material_name }}</div>
                                        <div class=""
                                             style="font-size: 25px; line-height: 31px;">{{ topic.title }}</div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                </div>

            {% endif %}
        </div>

    {% endif %}


{% endblock %}

{% block js %}
    <script src="{% static 'pages/js/topic.js' %}"></script>
{% endblock js %}

